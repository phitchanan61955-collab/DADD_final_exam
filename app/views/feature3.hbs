<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>{{title}}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    .page-wrap { max-width: 1080px; }
    .mono { font-variant-numeric: tabular-nums; }
    .table thead th { position: sticky; top: 0; z-index: 1; }
  </style>
</head>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand fw-semibold" href="/">DADD Dashboard</a>
      <div class="ms-auto">
        <a href="/" class="btn btn-outline-light btn-sm">← Back to Home</a>
      </div>
    </div>
  </nav>

  <main class="container page-wrap py-4">

    <div class="mb-3">
      <h1 class="h4 mb-1">Feature 3: Region &amp; Decade</h1>
      <p class="text-muted small mb-0">
        Select a region and a decade to view each sub-region and its <strong>average DADD</strong> in that decade.
      </p>
    </div>

    <!-- Filter -->
    <div class="card border-0 shadow-sm mb-3">
      <div class="card-body">
        <div class="fw-semibold mb-2">Filter</div>

        <form method="get" action="/feature3" class="row g-2 align-items-end">

          <div class="col-12 col-md-6 col-lg-5">
            <label class="form-label small mb-1" for="region_id">Region</label>
            <select class="form-select form-select-sm" name="region_id" id="region_id" required>
              <option value="">-- Select region --</option>
              {{#each regions}}
                <option value="{{this.region_id}}"
                  {{#ifEquals this.region_id ../selectedRegion}}selected{{/ifEquals}}>
                  {{this.region_name}}
                </option>
              {{/each}}
            </select>
          </div>

          <div class="col-12 col-md-6 col-lg-4">
            <label class="form-label small mb-1" for="decade">Decade</label>
            <select class="form-select form-select-sm" name="decade" id="decade" required>
              <option value="">-- Select decade --</option>
              {{#each decades}}
                <option value="{{this.decade_id}}"
                  {{#ifEquals this.decade_id ../selectedDecade}}selected{{/ifEquals}}>
                  {{this.decade_id}}
                </option>
              {{/each}}
            </select>
          </div>

          <div class="col-12 col-lg-3 d-flex gap-2">
            <button class="btn btn-primary btn-sm w-100" type="submit">Show Results</button>
            <a class="btn btn-outline-secondary btn-sm w-100" href="/feature3">Reset</a>
          </div>
        </form>

      </div>
    </div>

    <!-- Results -->
    <div class="card border-0 shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <div class="fw-semibold">Results</div>
          {{#if results.length}}
            <div class="small text-muted">
              Showing <strong>{{results.length}}</strong> sub-regions
            </div>
          {{/if}}
        </div>

        {{#if results.length}}
          <div class="alert alert-light border small mb-2">
            <span class="text-muted">Region:</span>
            <strong>{{results.[0].region_name}}</strong>
            <span class="text-muted">• Decade:</span>
            <strong>{{results.[0].decade_id}}</strong>
          </div>

          <div class="table-responsive">
            <table class="table table-sm table-striped table-hover align-middle mb-0 mono">
              <thead class="table-light">
                <tr>
                  <th style="min-width:260px;">Sub-Region</th>
                  <th class="text-center" style="width:90px;">Decade</th>
                  <th class="text-end" style="width:160px;">Avg DADD</th>
                  <th class="text-end" style="width:160px;">Countries Count</th>
                </tr>
              </thead>
              <tbody>
                {{#each results}}
                  <tr>
                    <td class="fw-semibold">{{this.sub_region_name}}</td>
                    <td class="text-center">{{this.decade_id}}</td>
                    <td class="text-end">
                      <span class="badge text-bg-primary">
                        {{this.avg_dadd}}
                      </span>
                    </td>
                    <td class="text-end">
                      <span class="badge text-bg-light border">
                        {{this.country_count}}
                      </span>
                    </td>
                  </tr>
                {{/each}}
              </tbody>
            </table>
          </div>
        {{else}}
          <div class="alert alert-warning mb-0">
            No data. Please select a region and a decade.
          </div>
        {{/if}}
      </div>
    </div>

  </main>
</body>
</html>
