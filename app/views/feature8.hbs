<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>{{title}}</title>

    <!-- Bootstrap 5 -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    >
  </head>
  <body class="bg-light">

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand fw-semibold" href="/">DADD Dashboard</a>
      <div class="ms-auto">
        <a href="/" class="btn btn-outline-light btn-sm">← Back to Home</a>
      </div>
    </div>
  </nav>

    <div class="container pb-5">

      <!-- Page Header -->
      <div class="row mb-4">
        <div class="col-12 col-lg-8">
          <div class="card shadow-sm border-0">
            <div class="card-body">
              <h1 class="h4 mb-2">Feature 8: Decade Summary &amp; Country Trend</h1>
              <p class="text-muted small mb-1">
                หน้านี้ทำหน้าที่เป็น <strong>Analytics Dashboard</strong> ของระบบ DADD:
                สรุปภาพรวมตาม Decade และดูแนวโน้มของประเทศแบบ Time-Series
              </p>
              <p class="text-muted small mb-0">
                Part A: เลือก Decade เพื่อดู Summary ของค่าช่วยเหลือ (DADD) ทั้งหมด<br>
                Part B: เลือกประเทศเพื่อดู Trend ของค่า DADD ในแต่ละ Decade
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- ===================== -->
      <!-- Part A: Decade Summary -->
      <!-- ===================== -->
      <div class="row mb-4">
        <div class="col-12 col-lg-5 mb-3">
          <div class="card shadow-sm border-0 h-100">
            <div class="card-body">
              <h2 class="h6 mb-3">Part A · Decade Summary</h2>

              <form method="get" action="/feature8" class="row g-2 align-items-end">
                <div class="col-12">
                  <label for="summary_decade" class="form-label small mb-1">
                    Select Decade
                  </label>
                  <select name="summary_decade" id="summary_decade" class="form-select form-select-sm">
                    <option value="">-- Select decade --</option>
                    {{#each decades}}
                      <option value="{{this.decade_id}}"
                        {{#ifEquals this.decade_id ../summaryDecade}}selected{{/ifEquals}}>
                        {{this.decade_id}}
                      </option>
                    {{/each}}
                  </select>
                </div>

                <!-- preserve trendCountryId ถ้ามี -->
                {{#if trendCountryId}}
                  <input type="hidden" name="trend_country_id" value="{{trendCountryId}}">
                {{/if}}

                <div class="col-12 mt-2">
                  <button type="submit" class="btn btn-primary btn-sm">
                    Show Summary
                  </button>
                </div>
              </form>

              {{#if summary}}
                <hr class="mt-3 mb-2">

                <p class="small text-muted mb-2">
                  Summary for Decade <strong>{{summaryDecade}}</strong>
                </p>

                <div class="row g-2">
                  <!-- Total Countries -->
                  <div class="col-6">
                    <div class="card border-0 bg-light-subtle">
                      <div class="card-body py-2 px-2">
                        <p class="text-muted small mb-1">Total Countries</p>
                        <p class="fw-semibold mb-0">
                          {{summary.total_countries}}
                        </p>
                      </div>
                    </div>
                  </div>

                  <!-- Average DADD -->
                  <div class="col-6">
                    <div class="card border-0 bg-light-subtle">
                      <div class="card-body py-2 px-2">
                        <p class="text-muted small mb-1">Average DADD</p>
                        <p class="fw-semibold mb-0">
                          {{summary.avg_dadd}}
                        </p>
                      </div>
                    </div>
                  </div>

                  <!-- Max DADD -->
                  <div class="col-12 col-md-6">
                    <div class="card border-0 bg-light-subtle">
                      <div class="card-body py-2 px-2">
                        <p class="text-muted small mb-1">Highest DADD</p>
                        {{#if topCountry}}
                          <p class="small mb-0">
                            <strong>{{topCountry.country_name}}</strong><br>
                            <span class="text-muted">DADD: {{topCountry.dadd_value}}</span>
                          </p>
                        {{else}}
                          <p class="small mb-0">-</p>
                        {{/if}}
                      </div>
                    </div>
                  </div>

                  <!-- Min DADD -->
                  <div class="col-12 col-md-6">
                    <div class="card border-0 bg-light-subtle">
                      <div class="card-body py-2 px-2">
                        <p class="text-muted small mb-1">Lowest DADD</p>
                        {{#if bottomCountry}}
                          <p class="small mb-0">
                            <strong>{{bottomCountry.country_name}}</strong><br>
                            <span class="text-muted">DADD: {{bottomCountry.dadd_value}}</span>
                          </p>
                        {{else}}
                          <p class="small mb-0">-</p>
                        {{/if}}
                      </div>
                    </div>
                  </div>
                </div>
              {{else}}
                <hr class="mt-3 mb-2">
                <p class="small text-muted mb-0">
                  กรุณาเลือก Decade เพื่อดูสรุปภาพรวมของค่า DADD.
                </p>
              {{/if}}
            </div>
          </div>
        </div>

        <!-- Part A: Optional raw table (ถ้าอยากขยายก็แยก section ได้) -->
        <div class="col-12 col-lg-7 mb-3">
          <div class="card shadow-sm border-0 h-100">
            <div class="card-body">
              <h2 class="h6 mb-3">Summary Table</h2>
              {{#if summary}}
                <table class="table table-sm table-bordered align-middle mb-0">
                  <thead class="table-light">
                    <tr>
                      <th scope="col">Metric</th>
                      <th scope="col">Value</th>
                    </tr>
                  </thead>
                  <tbody class="small">
                    <tr>
                      <td>Total Countries (with DADD in this decade)</td>
                      <td>{{summary.total_countries}}</td>
                    </tr>
                    <tr>
                      <td>Average DADD</td>
                      <td>{{summary.avg_dadd}}</td>
                    </tr>
                    <tr>
                      <td>Highest DADD</td>
                      <td>
                        {{#if topCountry}}
                          {{topCountry.country_name}} ({{topCountry.dadd_value}})
                        {{else}}
                          -
                        {{/if}}
                      </td>
                    </tr>
                    <tr>
                      <td>Lowest DADD</td>
                      <td>
                        {{#if bottomCountry}}
                          {{bottomCountry.country_name}} ({{bottomCountry.dadd_value}})
                        {{else}}
                          -
                        {{/if}}
                      </td>
                    </tr>
                  </tbody>
                </table>
              {{else}}
                <p class="small text-muted mb-0">
                  ยังไม่มีข้อมูล summary เนื่องจากยังไม่ได้เลือก Decade.
                </p>
              {{/if}}
            </div>
          </div>
        </div>
      </div>

      <!-- ========================= -->
      <!-- Part B: Country Trend     -->
      <!-- ========================= -->
      <div class="row">
        <div class="col-12">
          <div class="card shadow-sm border-0 mb-3">
            <div class="card-body">
              <h2 class="h6 mb-3">Part B · Country Trend over Decades</h2>

              <form method="get" action="/feature8" class="row g-2 align-items-end mb-3">
                <div class="col-12 col-md-5">
                  <label for="trend_country_id" class="form-label small mb-1">
                    Select Country
                  </label>
                  <select name="trend_country_id" id="trend_country_id" class="form-select form-select-sm">
                    <option value="">-- Select country --</option>
                    {{#each countries}}
                      <option value="{{this.country_id}}"
                        {{#ifEquals this.country_id ../trendCountryId}}selected{{/ifEquals}}>
                        {{this.country_name}} (ID: {{this.country_id}})
                      </option>
                    {{/each}}
                  </select>
                </div>

                <!-- preserve summaryDecade ถ้ามี -->
                {{#if summaryDecade}}
                  <input type="hidden" name="summary_decade" value="{{summaryDecade}}">
                {{/if}}

                <div class="col-12 col-md-3 mt-2 mt-md-0">
                  <button type="submit" class="btn btn-success btn-sm">
                    Show Trend
                  </button>
                </div>
              </form>

              {{#if trendData.length}}
                <div class="table-responsive">
                  <table class="table table-sm table-striped align-middle mb-0">
                    <thead class="table-light">
                      <tr>
                        <th scope="col">Decade</th>
                        <th scope="col">DADD Value</th>
                        <th scope="col" style="width: 220px;">Trend (relative bar)</th>
                      </tr>
                    </thead>
                    <tbody class="small">
                      {{#each trendData}}
                        <tr>
                          <td>{{this.decade_id}}</td>
                          <td>{{this.dadd_value}}</td>
                          <td>
                            <div class="bg-light" style="height: 12px;">
                              <div style="height: 12px; width: {{this.barWidth}}%; background:#0d6efd;"></div>
                            </div>
                          </td>
                        </tr>
                      {{/each}}
                    </tbody>
                  </table>
                </div>
              {{else}}
                <p class="small text-muted mb-0">
                  กรุณาเลือก Country เพื่อดู Trend ของค่า DADD ในแต่ละ Decade.
                </p>
              {{/if}}

            </div>
          </div>
        </div>
      </div>

    </div> <!-- /container -->

  </body>
</html>
